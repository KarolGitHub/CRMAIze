{% extends "base.twig" %}

{% block title %}CRMAIze - Campaigns
{% endblock %}

{% block head %}
	<style>
		.campaign-card {
			background: white;
			border-radius: 8px;
			box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
			margin-bottom: 1rem;
		}
		.status-draft {
			color: #664d03; /* Darker yellow for better contrast */
		}
		.status-sent {
			color: #0f5132; /* Darker green for better contrast */
		}
		.status-cancelled {
			color: #721c24; /* Darker red for better contrast */
		}
		.segment-badge {
			display: inline-block;
			padding: 0.25rem 0.5rem;
			border-radius: 4px;
			font-size: 0.8rem;
		}
		.segment-at-risk {
			background: #dc3545;
			color: white;
		}
		.segment-loyal {
			background: #17a2b8;
			color: white;
		}
		.segment-high-value {
			background: #28a745;
			color: white;
		}
	</style>
{% endblock %}

{% block content %}
	<div class="grid-container">
		<div class="grid-x grid-padding-x">
			<div class="cell">
				<div class="grid-x grid-padding-x align-justify">
					<div class="cell medium-6">
						<h2>
							<i class="fas fa-bullhorn"></i>
							Campaigns</h2>
					</div>
					<div class="cell medium-6 text-right">
						<a href="/campaigns/create" class="button large">
							<i class="fas fa-plus"></i>
							Create Campaign
						</a>
					</div>
				</div>
				<hr>
			</div>

			{% if campaigns %}
				{% for campaign in campaigns %}
					<div class="cell">
						<div class="campaign-card">
							<div class="card-section">
								<div class="grid-x grid-padding-x align-middle">
									<div class="cell medium-8">
										<h5>{{ campaign.name }}</h5>
										<p class="subheader">
											<i class="fas fa-tag"></i>
											{{ campaign.type|title }}
											Campaign
											{% if campaign.target_segment %}
												• Target:
												<span class="segment-badge segment-{{ campaign.target_segment }}">{{ campaign.target_segment|replace('_', ' ')|title }}</span>
											{% endif %}
										</p>

										{% if campaign.subject_line %}
											<p>
												<strong>Subject:</strong>
												{{ campaign.subject_line }}</p>
										{% endif %}

										{% if campaign.discount_percent %}
											<p>
												<strong>Discount:</strong>
												{{ campaign.discount_percent }}%</p>
										{% endif %}

										<small class="text-muted">
											Created:
											{{ campaign.created_at|date('M j, Y') }}
											{% if campaign.sent_count > 0 %}
												• Sent to
												{{ campaign.sent_count }}
												customers
											{% endif %}
										</small>
									</div>

									<div class="cell medium-4 text-right">
										<span class="label status-{{ campaign.status }}">
											{{ campaign.status|title }}
										</span>

										<div class="button-group small">
											<a href="/campaigns/{{ campaign.id }}" class="button">
												<i class="fas fa-eye"></i>
												View
											</a>

											{% if campaign.status == 'draft' %}
												<button class="button success" onclick="sendCampaign({{ campaign.id }})">
													<i class="fas fa-paper-plane"></i>
													Send
												</button>
											{% endif %}
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				{% endfor %}
			{% else %}
				<div class="cell">
					<div class="callout text-center">
						<h5>
							<i class="fas fa-inbox"></i>
							No Campaigns Yet</h5>
						<p>Create your first campaign to start engaging with customers.</p>
						<a href="/campaigns/create" class="button large">
							<i class="fas fa-plus"></i>
							Create Your First Campaign
						</a>
					</div>
				</div>
			{% endif %}
		</div>
	</div>
</div>{% endblock %}{% block scripts %}
<script>
	function sendCampaign(campaignId) {
if (confirm('Are you sure you want to send this campaign? This action cannot be undone.')) {
fetch (`/campaigns/${campaignId}/send`, {
method: 'POST',
headers: {
'Content-Type': 'application/json'
}
}).then(response => response.json()).then(data => {
if (data.success) {
alert (`Campaign sent successfully! ${
data.message
}`);
location.reload();
} else {
alert('Error sending campaign: ' + data.message);
}
}).catch(error => {
alert('Error sending campaign: ' + error.message);
});
}
}
</script>{% endblock %}
